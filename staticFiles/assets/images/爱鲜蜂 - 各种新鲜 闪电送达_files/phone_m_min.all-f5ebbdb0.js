;window._bee_jsLoaded=window._bee_jsLoaded||{};window._bee_jsLoaded["phone_m_min.all.js"]=1;
/*!File[lib/GeoLocation.js]*/define("lib/GeoLocation",["lib/base","common/weixinUtils"],function(t,i){var s=function(t,i){document.addEventListener?document.addEventListener(t,i,!1):document.attachEvent&&(document.attachEvent(t,i),document.attachEvent("on"+t,i))},e={errTask:"{id:#{id},mark:#{_mark},code:#{errCode},msg:#{errMsg}}",runningTask:"{id:#{id},mark:#{_mark},status:#{_status}}",successTask:"{id:#{id},mark:#{_mark},expend:#{expend},accuracy:#{accuracy}}"},n={TASK_TIME:2e3,TRY_TIMES:4,ALL_TIMEOUT:4e3},a=function(){return window.WeiboJSBridge||navigator.geolocation?!0:$.isWindows||$.isMac?!1:!0},o=function(t,i){this.id=t,this._mark=i,this.geoMgr=null,this.geoResult=null,this._isFinish=!1,this._status="standby"};o.prototype={_success:function(t){this._finish(t,!0,!0)},_error:function(t,i,s){var e={errCode:t,errMsg:i};this._finish(e,!1,s)},_finish:function(t,i,s){if(!this._isFinish){var e=(new Date).getTime();this._isFinish=!0,this._status="finish",t.mark=this._mark,t.success=i,t.expend=e-this.taskStartTimestamp,this.geoResult=t,this.geoResult.timestamp=e,this.geoMgr.onTaskFinish(this.id,t,s)}},run:function(){this.taskStartTimestamp=(new Date).getTime(),this.__run()},isFinished:function(){return this._isFinish},toString:function(){return this.geoResult?$.formatString(e[this.geoResult.success?"successTask":"errTask"],this,this.geoResult):$.formatString(e.runningTask,this)}};var r=$.inherits(o,{constructor:function(t){o.call(this,t,"wb")},__run:function(){var t=this;this._status="waitReady",window.WeiboJSBridge?this._doGeo():s("WeiboJSBridgeReady",function(){t._doGeo()})},_doGeo:function(){this._status="doing";var t=this;WeiboJSBridge.invoke("getLocation",{},function(i,s,e){if(s)t._success({latitude:i.lat,longitude:i["long"],accuracy:-1});else{var n=WeiboJSBridge.STATUS_CODE||{},a="",o=!1;$.each("SERVICE_FORBIDDEN,USER_CANCELLED".split(","),function(t,i){return n[i]==e?(a=i,o=!0,!1):void 0}),t._error(e,a,o)}})}}),c=$.inherits(o,{constructor:function(t){o.call(this,t,"wx")},__run:function(){var t=this;this._status="waitReady",i.getLocation(function(i,s){i?t._success(s):t._error(-1,s)})}}),u=$.inherits(o,{constructor:function(t){o.call(this,t,"h5")},__run:function(){var t,i,s=this;if(s._status="doing",window.SYS_CONF&&window.SYS_CONF.serverDectGps){var e=window.SYS_CONF.serverDectGps;return void setTimeout(function(){s._success({latitude:e.lat||e.latitude,longitude:e.lng||e.longitude||e.lon,accuracy:-1})},50)}return(t=$.getParam("lat",$.getParam("latitude")))&&(i=$.getParam("lng",$.getParam("longitude")))?void setTimeout(function(){s._success({latitude:parseFloat(t),longitude:parseFloat(i),accuracy:-1})},50):void navigator.geolocation.getCurrentPosition(function(t){var i=t.coords;s._success({latitude:i.latitude,longitude:i.longitude,accuracy:i.accuracy})},function(t){s._error(t.code,t.message,t.code==t.PERMISSION_DENIED)},{enableHighAccuracy:!0,maximumAge:0,timeout:n.TASK_TIME})}}),d=$.inherits(o,{constructor:function(t){o.call(this,t,"360")},__run:function(){var t=this;this._status="waitReady",window.plus?this._doGeo():s("plusready",function(){t._doGeo()})},_doGeo:function(){this._status="doing";var t=this;plus.geolocation.getCurrentPosition(function(i){t._success({latitude:i.coords.latitude,longitude:i.coords.longitude,accuracy:i.coords.accuracy})},function(i){t._error(-1,i)})}}),_=$.inherits(o,{constructor:function(t){o.call(this,t,"baiduapp")},__run:function(){var t=this;this._status="waitReady";var i=function(){return window.clouda.device.geolocation?void clouda.device.geolocation.get({onsuccess:function(i){t._success(i)},onfail:function(i){t._error(i,i)}}):void setTimeout(i,50)};window.clouda&&clouda.device?i():this._error(-1,"undefined")}}),h=function(){this._taskArr=[],this._taskCount=0,this._hadFinish=!1,this._taskTicker=null,this._successTaskId=null,this._startTimestamp=(new Date).getTime(),this._hadMakeReport=!1,this.expend=0};h.prototype={run:function(t){var i=this;if(this._callback=function(s){i._isCalled||(i._result=s,t(s),i._isCalled=!0)},this._result)return void t(this._result);setTimeout(function(){i._hadFinish||(i._hadFinish=!0,i._callback({success:!1,error:"unavailable"})),i._makeReport()},n.TRY_TIMES*n.TASK_TIME+n.ALL_TIMEOUT);var s=function(){var t=i._taskCount++;i._createTask(t,!(t%2)),i._taskCount<6&&(i._taskTicker=setTimeout(s,n.TASK_TIME))};s()},onTaskFinish:function(i,s,e){if(s.success&&!this._hadFinish){this._successTaskId=i,this._hadFinish=!0;var n=this,a=!1;if("yingyongbao"==$.getParam("tn")?a=3:"baidu"==$.getParam("postype",!1)||window.SYS_CONF.serverDectGps||(a=1),a){var o=s.longitude+","+s.latitude;t.getBaiduConv(o,a,function(t){t&&t.length>0&&(s.longitude=t[0].x,s.latitude=t[0].y),n._callback(s)})}else n._callback(s)}e&&(clearTimeout(this._taskTicker),this._callback(s),this._makeReport())},_addTask:function(t){t.geoMgr=this,this._taskArr[t.id]=t,t.run()},_createTask:function(t,i){this._addTask(i&&$.isWeibo?new r(t):i&&$.isWeixin&&SYS_CONF.sns&&SYS_CONF.sns.signedParam?new c(t):"360"==$.getParam("tn")||navigator.userAgent.indexOf("qihoo")>-1?new d(t):i&&$.isBaiduapp?new _(t):new u(t))},_makeReport:function(){if(!this._hadMakeReport){this._hadMakeReport=!0,this.expend=(new Date).getTime()-this._startTimestamp;var i,s=this;i=void 0==this._successTaskId?{success:!1}:{success:!0,taskId:s._successTaskId,taskCount:s._taskCount,accuracy:s._taskArr[s._successTaskId].geoResult.accuracy},i.expend=this.expend,i.tasks=this._taskArr.join(","),t.clickLog("sys_geolocation",i)}}};var l=null,g=function(t){return a()?(l||(l=new h),void l.run(t)):void setTimeout(function(){t({success:!1,error:"unsupport"})},10)};return{isSupportLocation:a,getGPSPosition:g}});
/*!File[lib/Storage.js]*/define("lib/Storage",["lib/base","lib/EventObj"],function(t,e){var r="bee_",o=function(){var e=window.name.match(/^NS_(.+)/);if(e)try{this.storage=t.jsonDecode(e[1])}catch(r){this.storage={}}else this.storage={}};o.prototype={getItem:function(t){return this.storage[t]||null},setItem:function(e,r){this.storage[e]=r,window.name="NS_"+t.jsonEncode(this.storage)},removeItem:function(e){delete this.storage[e],window.name="NS_"+t.jsonEncode(this.storage)}};var n=$.inherits(e,{constructor:function(t){e.call(this),this.customKey=t,this.localStorage=window.localStorage||new o,this._hadSendError=!1},set:function(e,r){var o,n=this._getKey(e),s=$.isString(r)||$.isNumber(r)?r:t.jsonEncode(r);try{o=this.localStorage.setItem(n,s)}catch(i){t.sendError("Storage set error:"+String(i),"Storage.js")}return o},get:function(e){var r,o=this._getKey(e);try{r=this.localStorage.getItem(o)}catch(n){t.sendError("Storage get error"+String(n),"Storage.js")}return!r||0!==r.indexOf("{")&&0!=r.indexOf("[")?r:t.jsonDecode(r)},del:function(t){this.localStorage.removeItem(this._getKey(t))},_getKey:function(t){return r+this.customKey+"_"+t}});return n.NameStorage=o,n});
/*!File[common/Share.js]*/define("common/Share",function(){return{getWeixinDefaultShareObj:function(){return{title:"馋了吗？找爱鲜蜂！",description:"馋了？忙呢？召唤鲜蜂侠，鲜果咖啡，坚果卤味，各种新鲜，闪电送达！",imgUrl:"http://weixin.beequick.cn/static/bee/img/icon_100-6607ff98.png",link:"http://m.beequick.cn"}},getProductShareObj:function(e,i){return{title:"爱鲜蜂-各种新鲜闪电送达",description:"#爱鲜蜂# "+e.name,imgUrl:e.app_mimg,link:"http://m.beequick.cn/show/productDetail?id="+e.id+"&shopId="+i}},getOrderShareObj:function(e){var i=e.order_goods,t=i&&i[0]&&i[0][0]&&i[0][0].img?i[0][0].img:"http://weixin.beequick.cn/static/bee/img/icon_100-6607ff98.png";return{title:"爱鲜蜂-各种新鲜闪电送达",description:"我在爱鲜蜂补充能量ing……这里各种新鲜全都有，你懂的，千万别来找我！",imgUrl:t,link:"http://m.beequick.cn/show/share?key="+e.share_key}},getActiveShareObj:function(){}}});
/*!File[common/weixinUtils.js]*/define("common/weixinUtils",["lib/base","common/Share"],function(n,e){var i={shareMask:'<div id="mod-sharemask" class="mod-sharemask"></div>'},o=!1,s=($.noop,function(n){o||$(i.shareMask).appendTo("body").on($.tapClick,function(){$(this).css("display","none")}),o=!0,$("#mod-sharemask").css("display","block").css("background-color",n?"rgba(0,0,0,.45)":"transparent")}),c=function(n,i){n=n||e.getWeixinDefaultShareObj(),t(function(e){if(e){var o={title:n.title,desc:n.description||n.desc,link:n.link,imgUrl:n.imgUrl,success:n.success||i||$.noop},s={title:n.description||n.desc,desc:n.title,link:n.link,imgUrl:n.imgUrl,success:n.success||i||$.noop},c=-1==n.imgUrl.indexOf(".beequick.cn");"test"!=SYS_CONF.environ&&o.imgUrl.indexOf("@")<0&&c&&(o.imgUrl+="@100h_100w_0e_1l%7C90Q",s.imgUrl+="@100h_100w_0e_1l%7C90Q"),wx.onMenuShareTimeline(s),wx.onMenuShareAppMessage(o),wx.onMenuShareQQ(o),wx.onMenuShareWeibo(o)}})},r=function(n){return function(){t(function(e){e&&wx[n]&&wx[n]()})}},t=n.onceExecMulitCallFn(function(){var e=this;$.isWeixin&&window.wx&&window.SYS_CONF&&window.SYS_CONF.sns&&window.SYS_CONF.sns.weixinJsApiConf?(wx.config(window.SYS_CONF.sns.weixinJsApiConf),wx.ready(function(){e.done(!0),c()}),wx.error(function(i){window._bee_sendError("weixin init error:"+n.jsonEncode(i)),e.done(!1)})):e.done(!1)}),a=function(e){t(function(i){return i?void wx.scanQRCode({needResult:1,scanType:["qrCode"],success:function(i){if($.isString(i)){var o=n.jsonDecode(i.resultStr);e(!0,o.scan_code.scan_result)}else if(i.resultStr){var s=!1;try{s=n.jsonDecode(i.resultStr)}catch(c){}e(!0,s?s.scan_code.scan_result:i.resultStr)}},fail:function(){e(!1,"扫描失败")},cancel:function(){e(!1,"扫描被取消")}}):void e(!1,"认证失败")})},d=function(n,e){e=e||$.noop,n.timestamp=n.timestamp||n.timeStamp,n.success=n.fail=n.cancel=function(n){var i=n.err_msg||n.errMsg;i.indexOf("ok")>0?e(!0,"支付成功"):i.indexOf("cancel")>0?e(!1,"支付被取消"):e(!1,"支付失败")},t(function(i){return i?void wx.chooseWXPay(n):void e(!1,"认证失败")})},u=function(n){t(function(e){return e?void wx.getLocation({type:"wgs84",success:function(e){n(!0,e.res||e)},fail:function(e){n(!1,e.err_msg||e.errMsg)}}):void n(!1,"认证失败")})};return{init:t,showToolbar:r("showToolbar"),hideToolbar:r("hideToolbar"),showOptionMenu:r("showOptionMenu"),hideOptionMenu:r("hideOptionMenu"),closeWindow:r("closeWindow"),shareTip:s,setShare:c,scanQRCode:a,pay:d,getLocation:u}});
/*!File[common/Promotion.js]*/define("common/Promotion",["lib/base","common/Dialog"],function(t){var i=function(t){this.shoppingCart=t,this.promotion=SYS_CONF.promotion,this.checkMethodList="exclusive,productExclusion,countLimit,brandExclusion,number,totalSku".split(","),this.defaultPropText=this.propText="￥0起送",this.cityid=0};return i.prototype={setShopData:function(t){this.propText=this.defaultPropText,this.cityid=t.cityid},_getExclusive:function(){var i=t.safeGetProp(SYS_CONF,"promotion.exclusive");if(i){var r,n,e={};for(r in i)n=parseInt(i[r]),e[r]={checkNumber:n};return e}return!1},_getDefaultMinPrice:function(){return 2==this.cityid?0:30},getPropText:function(t,i){return 1==t?"¥0起送，满¥49免运费，不满¥49收取¥10运费":t>1e4?"新鲜美食，闪电送达":this.shoppingCart.isSelfTakeVersion()||i?2==this.cityid||22==this.cityid||424==this.cityid||524==this.cityid||1692==this.cityid||3134==this.cityid||1717==this.cityid?"¥0起送，22:00前满¥30免运费，22:00后满¥50免运费":"¥0起送，满¥30免运费":this.propText},checkShoppingCartError:function(t){return this._doCheck(this.checkMethodList,t)},getIsStart:function(t){return this.promotion.timestart&&this.promotion.timestart[t]?this.promotion.timestart[t].isStart:!1},getStartConf:function(t){return this.promotion.timestart&&this.promotion.timestart[t]?this.promotion.timestart[t]:null},getMinPrice:function(t){return 0},_doCheck:function(t,i){for(var r,n=this.shoppingCart.getShoppingMap(!0,i.cart_group_id),e=0,o=t.length;o>e;e++){r=t[e];var a=this["_check_"+r](i,n,this.shoppingCart.shoppingList);if(a)return a}return!1},_check_exclusive:function(t,i){var r,n,e,o=!1,a=t.cid||t.category_id,s=!1;for(r in i){var c=i[r];if(o=!0,156==(c.category_id||c.cid)){s=c.name;break}}if(n=this._getExclusive())for(e in n){if(i[e])return t.id==e?t.name+"只能购买一个哦":i[e].name+"\n无法同其他商品同时购买哦";if(t.id==e&&o)return t.name+"只能单独下单哦"}if(156==a){if(s)return"秒杀商品一次仅能购买一个哦";if(o)return t.name+"只能单独下单哦"}else if(s)return s+"\n无法同其他商品同时购买哦"},_check_productExclusion:function(i,r){var n=t.safeGetProp(this.promotion,"exclusion.id");if($.isArray(n))for(var e=0,o=n.length;o>e;e++){for(var a,s=n[e].split(","),c=0,u=s.length;u>c&&(s[c]==i.id||!(a=r[s[c]]));c++);if(a&&$.isInArray(s,i.id))return a.name+" 和\n"+i.name+"\n不能同时购买哦~"}},_check_brandExclusion:function(i,r){var n=t.safeGetProp(this.promotion,"exclusion.brand");if($.isArray(n)){var e={};for(var o in r){var a=r[o];e[a.brand_id]=a.brand_name}for(var s=0,c=n.length;c>s;s++){var u=n[s].split(",");if(!$.isInArray(u,i.brand_id))return!1;for(var h=0,p=u.length;p>h;h++){var f=u[h];if(f!=i.brand_id&&!(i.cart_group_id>1e5&i.cart_group_id<15e4)&&e[f])return i.brand_name+" 和 "+e[f]+"\n需要在两个订单中购买哦~"}}}},_check_countLimit:function(t,i){var r,n,e=this.promotion.countLimit||{},o=t.id;return(r=parseInt(t.num_per_order||e[o]))&&(n=i[o]?i[o].shoppingCount:0,n>=r)?t.name+"\n最多只能购买"+r+"个哦~":void 0},_check_number:function(t,i,r){var n;if(!(n=this._getExclusive())||!n[t.id]||n[t.id].checkNumber){if(parseInt(t.number)<1&&!parseInt(t.hot_degree))return t.name+" 补货中..\n过段时间再来看看吧~";var e=r[t.id]?r[t.id].shoppingCount:0;return t.number<=e?t.name+" 库存不足了\n先买这么多，过段时间再来看看吧~":void 0}},_check_totalSku:function(t,i,r){var n,e=99,o=0;if(!r[t.id]){for(n in r)o++;if(o==e)return"购物车最多可添加"+e+"种商品"}}},i});
/*!File[common/ShoppingCart.js]*/define("common/ShoppingCart",["lib/EventObj","lib/Storage","common/Promotion"],function(i,t,s){var e=function(i){return parseFloat(Math.round(100*i)/100)},n=function(i,t){if($.isObject(i)&&$.isObject(t))for(var s in t)"shoppingCount"!=s&&"disabled"!=s&&"disabledText"!=s&&("dealer_id"!=s||t.dealer_id)&&("price"!=s||!i.no_refresh||t.no_refresh)&&"isSelected"!=s&&(i[s]=t[s]);return i},o=function(i){return i.disabled===!0||1===i.disabled},r=function(){return $.isApple&&$.appVersion>="2.4"||$.isAndroid&&$.appVersion>95&&105!=$.appVersion},a=function(i,t,s){s=s||{},r()||!$.isApp?(t=$.isBoolean(t)?t?1:0:parseInt(t),0===t?(i.disabledText="",i.maskText="",delete i.disableDetail):(i.disabledText=s.disabledText||"商品缺货",s.maskText&&(i.maskText=s.maskText)||delete i.maskText,s.disableDetail&&(i.disableDetail=s.disableDetail)||delete i.disableDetail)):t===!0||1===parseInt(t)?(t=!0,i.disabledText=disabledText||"商品缺货"):(t=!1,i.disabledText=""),i.disabled=t},p=function(i){var t,s={0:100,1:300,2:200,"true":300,"false":100},e=$.isApple&&$.appVersion>=3.1||$.isAndroid&&$.appVersion>239,n=e?0:i.length-1,o="",r=!1;for(i.sort(function(i,t){return i.disabled==t.disabled?i.disabledText!=t.disabledText?i.disabledText>t.disabledText?1:-1:i.limit_goods&&t.limit_goods?i.limit_goods-t.limit_goods:i.maskText!=t.maskText?i.maskText>t.maskText?-1:1:0:s[i.disabled||0]-s[t.disabled||0]});t=i[n];)t.disabled||(t.showDisableText=0),t.disabledText!=o||t.limit_goods!=r?(o=t.disabledText,r=t.limit_goods,t.showDisableText=1):t.showDisableText=0,n=e?n+1:n-1;return i},h=(window.SYS_CONF.promotion.shoppingCart||{},$.inherits(i,{constructor:function(){i.call(this),this.storage=new t("shoppingcart"),this.shoppingList=this.storage.get("shoppingList")||{},$.each(this.shoppingList,function(i,t){"isSelected"in t||(t.isSelected=!0)}),this.promotion=new s(this),this.productMap={},this.cartInfoObj={},this._calcCartInfo(),this._isTakeSelf=!1;var e=$.isApp?!1:Bee.getMod("common/Dialog",!0);this.alert=e?function(i){e.alert(i.replace(/\n/g,"<br/>"))}:$.noop,this._trackInfo=this.storage.get("track")||{},this._lastOpInfo={opSuccess:!0,opErrorMsg:"",noticeMsg:""}},addProduct:function(i,t){var s,e;if($.isString(i)||$.isNumber(i)){if(s=i,null==this.productMap&&!this.shoppingList[i])return void this._error("need setData before");if(!this.shoppingList[i]&&!this.productMap[s])return void this._error("id "+s+" 不存在")}$.isObject(i)&&(s=i.id,this.productMap[s]||(this.productMap[s]=i),i!=e&&(n(this.productMap[s],i),n(this.shoppingList[s],i))),e=this.productMap[s]||this.shoppingList[s];var o=this.promotion.checkShoppingCartError(e);return o?(this._error(o),!1):(2!=e.disabled&&a(e,!1),this._checkTakeSelf(e),t&&(e.track=t),e.track&&this._addTrack(e.id,e.track),this.shoppingList[s]||(this.shoppingList[s]=e,e.shoppingCount=0),this.shoppingList[s].shoppingCount++,this.shoppingList[s].isSelected=!0,this._fireChange("add",[s]),e)},deleteProduct:function(i,t){var s;if($.isString(i)||$.isNumber(i)){if(s=i,null==this.productMap&&!this.shoppingList[s])return this._error("need setData before"),!1}else s=i.id;return(this.shoppingList[s]||this.productMap[s])&&this.shoppingList[s]?(t?this.shoppingList[s].shoppingCount=0:this.shoppingList[s].shoppingCount--,2!=this.shoppingList[s].disabled&&a(this.shoppingList[s],!1),this.shoppingList[s].shoppingCount<1&&delete this.shoppingList[s],this._delTrack(s),this._fireChange("del",[s]),!0):!1},clearHideProduct:function(i){var t=[];if(i)for(var s in i)this.shoppingList[s]&&String(i[s].cart_group_id).indexOf("hide")>-1&&(t.push(this.shoppingList[s].id),delete this.shoppingList[s]);else for(var s in this.shoppingList)String(this.shoppingList[s].cart_group_id).indexOf("hide")>-1&&(t.push(this.shoppingList[s].id),delete this.shoppingList[s]);return this._fireChange("del",t),!0},addProductDataList:function(i){var t=this,s=function(i){$.each(i,function(i,s){t.addProductData(s)})};if($.isArray(i))s(i);else for(var e in i)if(!(parseInt(e)<=0)){var n=i[e];s(n)}},addProductData:function(i){i.price=parseFloat(i.price)||0,this.productMap[i.id]=i},setProductList:function(i){var t=this,s={},e=[];return this.productMap={},this.promotion.propText="闪电送，免运费",$.each(i,function(i,s){parseInt(i)<=0||$.each(s,function(i,s){524==s.cityid&&(t.promotion.propText="闪电送，免运费"),s.price=parseFloat(s.price)||0,t.productMap[s.id]=s})}),$.each(this.shoppingList,function(i,n){var o=null;if(o=t.productMap[i]){if(!parseInt(o.number)&&!parseInt(o.hot_degree))return void e.push(o);s[i]=o,o.shoppingCount=n.shoppingCount}else e.push(n)}),this.shoppingList=s,this._fireChange("data"),e.length&&this.fire("unableAutoRemoved",{unableList:e}),this},getIsTakeSelf:function(){return this._isTakeSelf},setIsTakeSelf:function(i){this._isTakeSelf=i;var t=this;$.each(this.shoppingList,function(i,s){t._checkTakeSelf(s)})},setDisableProducts:function(i){$.isString(i)&&(i=i.split(","));for(var t=0,s=i.length;s>t;t++){var e=i[t];this.shoppingList[e]&&a(this.shoppingList[e],!0,{disabledText:"商品缺货",maskText:"补货中"})}this._fireChange("data",i)},setShopData:function(i,t){var s=[];if(i&&(this.promotion.setShopData(i),this.shopId=i.zchtid,this.bigids=i.bigids),t){var e,o,r,p,h={};for(this.productMap={},r=0,p=t.length;p>r;r++)if(o=t[r],s.push(o.id),1!=o.is_gift&&(e=o.id,this.shoppingList[e])){o=n(this.shoppingList[e],o),o.number>0?a(o,!1):a(o,!0,{disabledText:"商品缺货",maskText:"补货中"}),h[e]=o,this.productMap[e]=o;var d=this.shoppingList[e],c=parseInt(d.shoppingCount),u=parseInt(o.number);1>u?(a(o,!0,{disabledText:"商品缺货",maskText:"补货中"}),o.shoppingCount=c):o.shoppingCount=c>u?u:c,i&&i.isInCart&&d.dealer_id&&(o.dealer_id=d.dealer_id),delete this.shoppingList[e]}for(e in this.shoppingList)o=this.shoppingList[e],a(o,!0,{disabledText:"商品缺货",maskText:"补货中"}),h[e]=o,156==(o.cid||o.category_id)&&this._notice("亲，有点小遗憾，您所在区域的此商品已抢光了！");this.shoppingList=h}this._fireChange("data",s)},setLimitGoods:function(i){var t=this;if($.isArray(i)){var s=[];$.each(i,function(i,e){var n=t.shoppingList[e.product_id];n&&(s.push(n.id),3==e.limit_type?a(n,!0,{disabledText:e.msg,maskText:"已下架",disableDetail:!0}):a(n,parseInt(e.limit_type),{disabledText:e.msg,maskText:1==e.limit_type?"补货中":""}),e.limit_goods&&(n.limit_goods=e.limit_goods))}),t._fireChange("data",s)}},setSelected:function(i,t){i+="",t=!!t;var s={},e=[];$.each(i.split(","),function(i,t){s[t]=!0}),$.each(this.shoppingList,function(i,n){var o=n.id,r=n.cart_group_id||0;(s[o]||s["group"+r])&&(n.isSelected=t,e.push(o))}),this._fireChange("select",e)},again:function(i){var t=this,s=[],e=[];$.each(i,function(i,t){$.each(t,function(i,t){1!=t.is_gift&&(s.push(t.id),e.push(t))})});var n=this.shopId,o=this.bigids;base.ajaxGet("/data/getProductInfo",{pids:s.join(","),shopId:n,bigids:o,__sync:!0},function(i){var s,n;s=0==i.errno?i.data:{},$.each(e,function(i,e){(n=s[e.id])?(n.shoppingCount=Math.min(e.goods_nums,n.number)||1,n.number<1&&a(n,1,{disabledText:"商品缺货",maskText:"补货中"})):(e.shoppingCount=parseInt(e.goods_nums)||1,e.price=parseFloat(e.goods_price||e.real_price),e.number=99,n=e,a(e,1,{disabledText:"商品缺货",maskText:"已下架",disableDetail:!0})),n.isSelected=!0,t.shoppingList[n.id]=n})}),this._fireChange("data",s)},updateProduct:function(i){if($.isArray(i))for(var t=0,s=i.length;s>t;t++){var e=i[t];$.isObject(e)&&this._updateProduct(e.id,e)}else if($.isObject(i))if(i.id)this._updateProduct(i.id,i),this._fireChange("data",[i.id]);else for(var n in i){var e=i[n];$.isObject(e)&&this._updateProduct(n,e)}},getTrackInfo:function(i){i=i||0;var t,s,e,n={},o=this.getShoppingMap(!0,i);for(t in this._trackInfo)o[t]&&(s=this._trackInfo[t],s.length&&(e={},$.each(s,function(i,t){e[t]?e[t]++:e[t]=1}),n[t]=e));return n},_addTrack:function(i,t){this._trackInfo[i]||(this._trackInfo[i]=[]),this._trackInfo[i].push(t)},_delTrack:function(i){$.isArray(this._trackInfo[i])&&this._trackInfo[i].length&&(this._trackInfo[i].pop(),0==this._trackInfo[i].length&&delete this._trackInfo[i])},_updateProduct:function(i,t){return i&&t&&$.isObject(t)&&parseInt(i)==i&&this.shoppingList[i]?($.extend(this.shoppingList[i],t),!0):!1},_checkTakeSelf:function(i){i.limit_take_self&&(this._isTakeSelf?a(i,0):a(i,1,{disabledText:"仅限自提，请点击[修改]切换配送方式"}))},removeDisabledProduct:function(){var i=this,t=[];$.each(this.shoppingList,function(s,e){o(e)&&(delete e.disabled,delete i.shoppingList[s],t.push(s),i.productMap&&i.productMap[s]&&i.productMap[s].disabled&&delete i.productMap[s].disabled)}),this._fireChange("data",t)},getShoppingList:function(i,t){t=t||0;var s,e,n=[];for(e in this.shoppingList)s=this.shoppingList[e],i&&s||(s.cart_group_id||0)==t&&n.push(s);return n},getShoppingMap:function(i,t){t=t||0;var s,e,n={};for(e in this.shoppingList)s=this.shoppingList[e],i&&o(s)||((s.cart_group_id||0)==t||String(t).indexOf("hide")>-1&&String(s.cart_group_id).indexOf("hide")>-1)&&(n[e]=s);return n},getProductById:function(i){return this.shoppingList[i]||null},getProductObjById:function(i){return this.productMap[i]},getGroupCountBy:function(i){var t={};return $.each(this.shoppingList,function(s,e){if(!o(e)){var n=e[i];t[n]=t[n]||0,t[n]+=e.shoppingCount}}),t},getIdformat:function(i,t){t=t||0;var s=[];for(var e in this.shoppingList){var n=this.shoppingList[e],r=n.cart_group_id||0;r==t&&(i&&n&&o(n)||n.isSelected&&s.push(e+":"+this.shoppingList[e].shoppingCount))}return s.join(",")},getPidDealers:function(i,t){t=t||0;var s=[];for(var e in this.shoppingList){var n=this.shoppingList[e],r=n.cart_group_id||0;r==t&&(i&&n&&o(n)||n.isSelected&&s.push(e+":"+(this.shoppingList[e].dealer_id||"")))}return s.join(",")},getCount:function(){return this.cartInfoObj.count},getDisabledCount:function(){var i=0;for(var t in this.shoppingList)this.shoppingList[t]&&o(this.shoppingList[t])&&i++;return i},getTotalPrice:function(){return this.cartInfoObj.price},reset:function(i){var t=this;if(void 0===i)this.shoppingList={},this._trackInfo={};else{var s={};$.each(this.shoppingList,function(e,n){var o=n.cart_group_id||0;return i==o?void delete t._trackInfo[n.id]:void(s[e]=n)}),this.shoppingList=s}return this._fireChange("reset"),this},filter:function(i,t){var s=!1;t||(s={});for(var e in this.shoppingList){var n=this.shoppingList[e];if(i(n)){if(t){s=n;break}s[e]=n}}return s},getCartInfo:function(){return this.cartInfoObj},_calcCartInfo:function(){var i={},t=[],s=this;this.cartInfoObj=this._calcCartGroupInfo(),$.each(this.shoppingList,function(t,s){!s.cart_group_id||0==s.cart_group_id||String(s.cart_group_id).indexOf("hide")>-1||(i[s.cart_group_id||0]=!0)});var s=this;$.each(i,function(i){var e="group"+i;t.push(e),s.cartInfoObj[e]=s._calcCartGroupInfo(i)}),this.cartInfoObj.groups=t,this.cartInfoObj.group1||(this.cartInfoObj.group1=this._calcCartGroupInfo(1));var n=this.cartInfoObj.count,o=this.cartInfoObj.price;$.each(this.cartInfoObj.groups,function(i,t){var e=s.cartInfoObj[t];n+=e.count,o+=e.price}),o=e(o),this.cartInfoObj.totalCount=n,this.cartInfoObj.totalPrice=o,this.cartInfoObj.totalPriceText="共￥"+o},_calcCartGroupInfo:function(i){i=i||0;var t=0,s=0,n=!1,o="",r="",a=this.shoppingList,h=!0;minPrice=this.promotion.getMinPrice(i),name=1==i?"新鲜预订":i?"周边美食":"闪送超市",$.each(this.getShoppingMap(!0,i),function(i,e){t+=e.shoppingCount||0,e.isSelected?s+=(parseFloat(e.price)||0)*e.shoppingCount:h=!1}),s=e(s),n=s>0&&s>=minPrice,o=n?"选好了":0==s?"满￥"+minPrice+"起送":"差￥"+e(minPrice-s)+"起送",r="￥"+minPrice+"起送";var a=this.getShoppingList(!1,i);($.isAndroid&&$.appVersion>143||$.isApple&&$.appVersion>=2.6||$.isMobile)&&p(a);var d=this,c={name:name,cart_group_id:i,isAllSelected:h,isOk:n,payType:2,price:s,count:t,minPrice:minPrice,priceText:"共￥"+s,btnText:o,propText:d.promotion.getPropText(i,$.isMobile),cartText:r,emptyText:"购物车是空的",trackInfo:base.jsonEncode(d.getTrackInfo(i)),shoppingList:a};return this._isTakeSelf&&i&&(c.disable=!0,c.disabledText="新鲜预定暂不支持自提服务"),c},_updateUi:function(i,t){var s=this.getCartInfo(),e=s.totalCount,n=s.isOk;$.each(s.groups,function(i,t){var e=s[t];e.isOk&&(n=!0)}),i[e?"removeClass":"addClass"]("shopping-empty"),i.find(".shopping-count").html(e).css("visibility",e?"visible":"hidden").addClass("erect"),setTimeout(function(){i.find(".shopping-count").removeClass("erect")},150),i.find(".shopping-total").html(e?s.totalPriceText:s.emptyText),i.find(".shopping-words").html(this.promotion.getPropText(0)),i.find(".shopping-submit-text").html(n?t:s.btnText),i.find(".shopping-submit").attr("disabled",!n)[n?"addClass":"removeClass"]("shopping-enable")},_fireChange:function(i,t){this._calcCartInfo(),this.fire("shoppingListChange",{reason:i,pidsArr:t}),this.storage.set("track",this._trackInfo),this.storage.set("shoppingList",this.shoppingList)},_notice:function(i){this.alert(i),$.isApple&&(this._lastOpInfo.noticeMsg=i)},_error:function(i){this._lastOpInfo.opSuccess=!1,this._lastOpInfo.opErrorMsg=i,this.alert(i)},getLastError:function(){var i=this._lastOpInfo;return this._lastOpInfo={opSuccess:!0,opErrorMsg:"",noticeMsg:""},i},isSelfTakeVersion:r}));return new h});
/*!File[common/AddrMgr.js]*/define("common/AddrMgr",["lib/base","lib/EventObj","lib/Storage"],function(r,t,d){var i=null,e=function(r){r.id&&(this.id=r.id),this._setProp(r)};return e.prototype={_setProp:function(r){for(var t in r)this[t]=r[t],"address"==t&&(this.addressSp=this.address.split(" "));this.config=r},getFullAddress:function(){return this.city_name+this.address},getAddressHead:function(){return this.addressSp[0]||""},getAddressTail:function(){return this.addressSp[1]||""},getGenderName:function(){return 1==this.gender?"先生":2==this.gender?"女士":""},isPoiVersion:function(){return 2==this.addressSp.length},update:function(r){this._setProp(r)},toObject:function(){return this.config}},AddrMgr=$.inherits(t,{constructor:function(){t.call(this),this.addrObjs={},this._likelyAddrIdMap={},this._inited=this.lastAddrId=!1,this.storage=new d("addrmgr"),this.defaultAddrId=this.storage.get("defid")||!1,window.SYS_CONF&&window.SYS_CONF.addrList&&this._init(window.SYS_CONF.addrList)},init:function(t){if(this._inited)return void(t&&t());var d=this;r.ajaxPost("/submit/getAddrList",{},function(r){0==r.errno?(d._init(r.data,!0),t&&t(),d.fire("addrListChange")):d.fire("addrError",{errmsg:r.errmsg})})},_init:function(r){var t=this;$.each(r,function(r,d){t.addrObjs[d.id]=new e(d)}),this._inited=!0,this.fire("addrListChange")},isInited:function(){return this._inited},logout:function(){this._inited=!1,this.addrObjs={},this.fire("addrListChange")},addNewAddr:function(t,d){var i=this,n=new e(t);r.ajaxPost("/submit/updateAddr",n.toObject(),function(r){if(0==r.errno){var t=r.data.id;n.id=t,i.addrObjs[t]=n,i.fire("addrListChange"),d&&d(n)}else d&&d(!1,r.errmsg),i.fire("addrError",{errno:r.errorno,errmsg:"添加失败:"+r.errmsg})})},updateAddr:function(t,d){var i=this,e=i.addrObjs[t.id];if(!e)return void i.fire("addrError",{errmsg:"更新失败:id不存在"});var n=$.extend(e.toObject(),t);r.ajaxPost("/submit/updateAddr",n,function(r){0==r.errno?(e.update(t),i.fire("addrListChange"),d&&d(e)):(d&&d(!1,r.errmsg),i.fire("addrError",{errno:r.errno,errmsg:"更新失败:"+r.errmsg}))})},delAddr:function(t,d){var i=this,e=i.addrObjs[t];e||this.fire("addrError",{errmsg:"删除失败:id不存在"}),r.ajaxPost("/submit/deleteAddr",{id:t},function(r){0==r.errno?(delete i.addrObjs[t],i.fire("addrListChange"),d&&d(e)):(d&&d(!1,r.errmsg),i.fire("addrError",{errno:r.errno,errmsg:"删除失败:"+r.errmsg}))})},setDefaultAddr:function(r){r||(r=""),this.defaultAddrId=r,this.storage.set("defid",r)},getDefaultAddr:function(){return this.addrObjs[this.defaultAddrId]||!1},getAddrById:function(r){return this.addrObjs[r]||!1},getAddrList:function(){var r=[];for(var t in this.addrObjs)r.push(this.addrObjs[t]);return r=r.sort(function(r,t){return parseInt(t.id)-parseInt(r.id)})},getAddrCount:function(){var r=0;for(var t in this.addrObjs)r++;return r}}),AddrMgr.getAreaSel=function(t){i?t(i):r.ajaxGet("/data/getAreaInfo",{},function(r){0==r.errno&&(i=r.data,t(i))})},AddrMgr});
/*!File[common/Dialog.js]*/define("common/Dialog",function(){var n=Bee.getMod($.isMobile?"common/Dialog_phone":"common/Dialog_www"),o={show:function(o){return n.show(o)},hide:function(){return n.hide()},alert:function(o,e,r){return n.alert(o,e,r)},verify:function(o,e,r,t){return n.verify(o,e,r,t)},confirm:function(o,e,r){return n.confirm(o,e,r)},confirmText:function(o,e,r,t){return n.confirmText(o,e,r,t)},tip:function(o){return n.tip(o)},popSelect:function(o){return n.popSelect(o)}};return o});
/*!File[m/Shop.js]*/define("m/Shop",["lib/base","lib/EventObj","common/ShoppingCart"],function(t,i,a){var s=$.inherits(i,{constructor:function(){i.call(this),this.shopId=this.status=this.addr=this.dealer=this.tmr_detail=this._isGps=this.addrName=this.act_info=null,this.actMap={}},setAddr:function(i,a){if(this._isGps=!!a,i===!1)return this.status="error",this.statusText="定位失败，请手动选择地址",this.addrName="定位失败",void this.fire("addrNameChange");var s=this;return this._isGps?(this.addrName="",t.getAddressInfoByPoint(i.latitude,i.longitude,function(t){s.addrName=(t.street||"定位地址")+"附近",s.fire("addrNameChange")})):(this.addrName=i.address,this.deferFire("addrNameChange")),this.load(i),this},getAddr:function(){return this.addr},getUserAddr:function(){return"error"==this.status||"unsupport"==this.status||this._isGps?!1:this.addr||!1},getActivityById:function(t){if($.isString(t))return this.actMap[t]||!1;if($.isArray(t))for(var i,a=0,s=t;s>a;a++)if(i=this.actMap[t[a]])return i;return!1},getActivityByGroup:function(t){for(var i in this.actMap){var a=this.actMap[i];if(a.ext_params&&a.ext_params.activitygroup==t)return a}},load:function(i){var i=i||this.addr;if(i){this._fireProgressing({status:"loading",text:"加载中"});var s,r=this,e=(i.longitude||i.lng)+","+(i.latitude||i.lat),d=[];return(s=$.getParam("pid",""))&&d.push(s),$.each(a.shoppingList,function(t,i){d.push(i.id)}),t.ajaxGet("/data/home",{cart_pids:d.join(","),location:e,defPid:s},function(t){if(0==t.errno){r.addr=i,r.dealer=t.data.dealer,r.shopId=r.dealer.zchtid,r.bigids=r.dealer.bigids,r.tmr_detail=t.data.tmr_detail,r.act_info=t.data.act_info,r.location_hash=t.data.location_hash,$.each(t.data.act_info,function(t,i){$.each(i.act_rows,function(t,i){i.activity&&(r.actMap[i.activity.id]=i.activity)})});var e=t.data.cart_ids||[];s&&e&&e.length&&e[0]&&e[0].id==s&&(r.defProduct=e[0],e.shift()),a.setShopData(t.data.dealer,t.data.cart_ids),r._fireProgressing({status:"done",text:"加载完成"})}else r._fireProgressing(13e3==t.errno?{status:"unsupport",text:t.errmsg}:{status:"error",text:t.errmsg})}),this}},_fireProgressing:function(t){this.status=t.status,this.statusText=t.text,this.fire("progressing",t)}});return s});
/*!File[m/bootstrap.js]*/Bee.boot(["lib/Storage","lib/GeoLocation","common/Dialog","common/Share","common/AddrMgr","m/Shop"],function(e,t,o,a,i,r){var n,s,d,c,l,u,p,m=null,g=function(){var e,t,o,a,i,r={},n=window.location.href.split("#"),s=n[1]?"#"+n[1]:"",d=n[0].split("?"),c=d[0].split("/"),l=(d[1]||"").split("&");if(e=c[2],o=c[3])for("menu"==o?t="/menu":"order"==o?t="/show/order":("show"==o||"quick"==o)&&(t="/"+o+"/"+c[4]),a=5;c[a];)r[c[a]]=c[a+1],a+=2;else t="/";for(a=0,i=l.length;i>a;a++){var u=l[a].split("=");u[0]&&(r[u[0]]=decodeURIComponent(u[1]))}return{domain:e,path:t,search:r,hash:s}},f=function(){var e=g();if("/show/orderlist"==e.path)return{type:"boot",viewName:"orderlist"};if("/show/order"==e.path)return{type:"boot",viewName:"order",args:{orderId:e.search.orderId||e.search.id,orderNo:e.search.orderNo||e.search.no}};var t;if((t=$.getParam("agroup"))||(t=$.getParam("aid")))return{type:"boot",viewName:"act",args:function(e){var a;return(a=$.getParam("agroup")?e.getActivityByGroup(t):e.getActivityById(t.split(",")))?{activityObj:a,isAutoload:!0}:void o.alert("当前活动已经结束<br/>更多精彩活动等您参与~",$.noop,"去看看")}};if(t=$.getParam("pid"))return{type:"boot",viewName:"detail",args:function(e){return e.defProduct?e.defProduct:void 0}};if(t=$.getParam("cid"))return{type:"nav",viewName:"menu",args:{categoryId:t}};if(t=$.getParam("bootview")){if("tmr"==t)return{type:"nav",viewName:"act",args:function(e){return e.tmr_detail?{activityObj:e.tmr_detail,isAutoload:!0}:void 0}};if("mine"==t)return{type:"nav",viewName:"mine"};if("orderlist"==t||"addrlist"==t||"coupon"==t||"msg"==t||"idea"==t||"help"==t||"about"==t)return{type:"boot",viewName:t}}},v=function(){if($.getParam("downloadTip",!1)){var t=new e("downloadTip"),o=(new Date).getTime(),a=t.get("closeTime");(!a||o>parseInt(a)+864e5)&&($("body").addClass("download-tip-show").append('<div id="mod-downloadtip" class="mod-downloadtip"><a href="'+base.addProtectedParams("/show/appDownload")+'">下载爱鲜蜂APP</a>&nbsp;&nbsp;更多缤纷好礼邀您共享</div>'),$("#mod-downloadtip").on($.tapClick,function(e){t.set("closeTime",(new Date).getTime()),e.target&&"A"==e.target.tagName||($("body").removeClass("download-tip-show"),setTimeout(function(){$(window).trigger("resize")},800))}))}},w=function(){if(d&&c&&l&&u){var e=Bee.getMod("m/main",!0);if(e&&($("#mod-bootstrap").css("display","none"),e.init(n,s),v()),p){if("nav"==p.type)e.initNavs(p.viewName,p.args);else if("boot"==p.type){var t=Bee.getMod("m/ViewMgr"),o=e.getCheckView(),a=new t("boot");a.on("destroy",function(){e.initNavs()}),o&&a.setCheckView(o),a.changeView("bootstrap",p)}}else e.initNavs()}},h=function(){t.getGPSPosition(function(e){d||(d=!0,e.success?n.setAddr(e,!0):n.setAddr(!1,!1),w())});var e=s.getDefaultAddr();!e||d||$.isBaidumap||(d=!0,n.setAddr(e),w())},y=function(){var e=$("#m-phone-img-css").val(),t=$("#m-phone-lazy-css").val();base.loadCss({src:t,onload:function(){l=!0,w(),base.loadCss({src:e})}})},b=function(){window._m_lazy_loaded=function(){c=!0,w()};var e=$("#m-phone-lazy-js");e.attr("src",e.data("src"))},N=function(){var e=f();if(e){var t=e.args||{};$.isFunction(t)?n.on("progressing",function(o){u||"loading"==o.status||("done"==o.status&&(t=t(n),t&&(e.args=t,p=e)),u=!0,w())}):(p=e,u=!0,w())}else setTimeout(function(){u=!0,w()},1e3)},P=function(){if($.isBaiduapp&&window.clouda){clouda.lightInit({ak:"Gw3bPxqMptqDz1raILOC6N2p",module:"geolocation,device,qr,socialshare".split(",")});var e=a.getWeixinDefaultShareObj();window.noop=$.noop,window.BoxShareData={successcallback:"noop",errorcallback:"noop",options:{type:"url",content:e.description,iconUrl:e.imgUrl,imageUrl:e.imgUrl,linkUrl:e.link,title:e.title,mediaType:"all"}},$.isAndroid&&delete window.BoxShareData.options.imageUrl}if($.isApple){var t=0;$(document).on("touchstart",function(e){e.touches&&e.touches[0]&&(t=e.touches[0].pageY)}),$(document).on("touchmove",function(e){var o=$(e.target).parents(".scroller");if(!o.length){if($(e.target).parents(".mod-activity").length)return;return e.preventDefault(),!1}if(e.touches&&e.touches[0]){var a=e.touches[0].pageY,i=o[0];0==i.scrollTop&&a>t?e.preventDefault():t>a&&i.scrollTop+i.clientHeight==i.scrollHeight&&e.preventDefault()}})}$(document).delegate("label",$.tapClick,function(){var e=$(this).attr("for"),t=document.getElementById(e);t&&t.type&&(t.checked=!0)})},A=function(e){m=e,n=new r,s=new i;try{P()}catch(t){}N(),h(),y(),b()};A()});